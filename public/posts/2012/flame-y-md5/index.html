<!DOCTYPE html>
<html lang="es-cl" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Flame y MD5 | La Naturaleza del Software</title>
<link rel="icon" href="/favicon.svg" sizes="any" type="image/svg+xml" /><meta property="og:url" content="http://localhost:1313/posts/2012/flame-y-md5/">
  <meta property="og:site_name" content="La Naturaleza del Software">
  <meta property="og:title" content="Flame y MD5">
  <meta property="og:description" content="En 2005 escribí una prueba de concepto donde usé una conocida vulnerabilidad de MD5 descubierta por Xiaoyun Wang en 20041, para engañar cualquier sistema que valide la firma digital de un archivo usando MD5. Posteriormente Peter Selinger desarrolló una mejora de mi esquema lo que permite automatizar aún más el proceso.
Mi prueba de concepto permite que dos programas distintos (uno “bueno” y otro “malvado”) tengan la misma firma MD5. Para que funcione mi esquema se requiere un tercer programa extractor. Sin embargo, Selinger mejoró mi esquema eliminando este tercer programa. En esencia lo que hace Selinger es crear un “programa esquizofrénico”, que contiene las dos personalidades del programa (la buena y la malvada).">
  <meta property="og:locale" content="es_cl">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2012-06-29T08:25:11-03:00">
    <meta property="article:modified_time" content="2012-06-29T08:25:11-03:00">
    <meta property="article:tag" content="Computación">
    <meta property="article:tag" content="Basic">
    <meta property="article:tag" content="Lenguajes De Programación">
    <meta property="article:tag" content="Historia">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Flame y MD5">
  <meta name="twitter:description" content="En 2005 escribí una prueba de concepto donde usé una conocida vulnerabilidad de MD5 descubierta por Xiaoyun Wang en 20041, para engañar cualquier sistema que valide la firma digital de un archivo usando MD5. Posteriormente Peter Selinger desarrolló una mejora de mi esquema lo que permite automatizar aún más el proceso.
Mi prueba de concepto permite que dos programas distintos (uno “bueno” y otro “malvado”) tengan la misma firma MD5. Para que funcione mi esquema se requiere un tercer programa extractor. Sin embargo, Selinger mejoró mi esquema eliminando este tercer programa. En esencia lo que hace Selinger es crear un “programa esquizofrénico”, que contiene las dos personalidades del programa (la buena y la malvada).">

    <link rel="stylesheet" href="/css/root.css">
    <link rel="stylesheet" href="/css/bundle.css">

      <script src="/js/bundle.js"></script><script defer src="/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js" integrity="sha256-ZFlLEl97eL30&#43;oMWlVkiu&#43;uxzWuu8/FmVL/KIDCfGPg="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>
<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="http://localhost:1313/" style="color: inherit;">La Naturaleza del Software</a>
  </div>
  <div class="nav-right">
    <div style="position:absolute;width:0px;height:0px;">
      <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="https://Newsletter.lnds.net"
      >Newsletter</a>
    </div>
    <div class="nav-item">
      <a href="/books/"
      >Books</a>
    </div>
    <div class="nav-item">
      <a href="/about/"
      >About</a>
    </div>
</div>
    </div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="https://Newsletter.lnds.net"
      >Newsletter</a>
    </div>
    <div class="nav-item">
      <a href="/books/"
      >Books</a>
    </div>
    <div class="nav-item">
      <a href="/about/"
      >About</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="http://localhost:1313/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span>&nbsp»&nbsp</span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="http://localhost:1313/posts/">
        <span itemprop="name">Posts</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span>&nbsp»&nbsp</span>
</ol>
<h1>Flame y MD5</h1><time class="dim" datetime="2012-06-29T08:25:11-03:00">June 29, 2012</time><div class="term-container"><div class="tag">
        <a href="http://localhost:1313/tags/computaci%C3%B3n/">#computación</a>
      </div><div class="tag">
        <a href="http://localhost:1313/tags/basic/">#basic</a>
      </div><div class="tag">
        <a href="http://localhost:1313/tags/lenguajes-de-programaci%C3%B3n/">#lenguajes de programación</a>
      </div><div class="tag">
        <a href="http://localhost:1313/tags/historia/">#historia</a>
      </div></ol></div>
  <section class="page-section"><p>En 2005 escribí una <a href="http://www.codeproject.com/Articles/11643/Exploiting-MD5-collisions-in-C">prueba de
concepto</a>
donde usé una conocida  vulnerabilidad de MD5  descubierta por Xiaoyun
Wang en 2004<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, para engañar cualquier sistema que valide la firma
digital de un archivo usando MD5. Posteriormente Peter Selinger
desarrolló una mejora de mi esquema lo que permite automatizar aún más
el proceso.</p>
<p>Mi prueba de concepto permite que dos programas distintos (uno &ldquo;bueno&rdquo;
y otro &ldquo;malvado&rdquo;) tengan la misma firma MD5.  Para que funcione mi
esquema se requiere un tercer programa extractor. Sin embargo, Selinger
mejoró mi esquema eliminando este tercer programa. En esencia lo que
hace Selinger es crear un &ldquo;programa esquizofrénico&rdquo;, que contiene las
dos personalidades del programa (la buena y la malvada).</p>
<p>En 2009 Didier Stevens usó el programa de Selinger para crear dos
programas con la misma firma digital Authenticode, un programa usado por
Microsoft para firmar digitalmente archivos.</p>
<p>Los mismos conceptos fueron usados por Marc Stevens, Arjen K. Lenstra y
Benne de Weger para crear programas que tienen la misma firma digital,
en este caso estos investigadores determinaron un conjunto de bytes que
se deben agregar al final de cada archivo para lograr el efecto.</p>
<p>Lo interesante de todo esto es que estos esquemas han sido usados en la
elaboración del temible virus conocido como
<a href="http://blogs.elpais.com/cronica-negra/2012/06/virus-flame-la-primera-bomba-atomica-de-la-ciberguerra.html">Flame</a>.</p>
<p><a href="http://es.wikipedia.org/wiki/Flame_(malware)">Flame</a> aparentemente es
una arma cibernética, al igual que
<a href="http://es.wikipedia.org/wiki/Stuxnet">Stuxnet</a>, cuyo objetivo es atacar
potencias extranjeras, en particular Irán y su programa atómico.</p>
<p>Marc Stevens <a href="http://www.cwi.nl/news/2012/cwi-cryptanalist-discovers-new-cryptographic-attack-variant-in-flame-spy-malware">investigó el código de Flame</a>
y descubrió que este usa un esquema similar a los descritos para hacer
pasar su código como una actualización válida de Windows:</p>
<blockquote>
<p>The first cryptographic collision attack against the cryptographic
hash function MD5 was invented by Xiaoyun Wang et al. in 2004 , which
however did not pose a serious immediate threat due to technical
limitations. Subsequently, we have devised a more flexible collision
attack against MD5 in 2007, a so-called chosen-prefix collision attack
. This posed a greater threat due to the removal of the most important
technical limitation. Finally, we refined our attack in 2008 and used
it to construct a rogue Certification Authority, thereby demonstrating
a serious vulnerability in internet security. Our demonstration
convinced Microsoft and various governments to raise the security
standards for Certification Authorities, by disallowing the use of
MD5-based signatures effective 15 January 2009.</p></blockquote>
<blockquote>
<p>It is clear that Microsoft, at that time, should have also disallowed
MD5-based signatures in their Terminal Server Licensing Service (TSLS).
As apparently the Flame collision attack was executed in February 2010,
it now turns out they did not; this has been an important oversight. The
result of this collision attack on a Microsoft TSLS Certification
Authority was a code-signing certificate appearing to be from Microsoft
that may be used to sign Windows Updates.  This attack avenue was
essentially open to any knowledgeable attackers since June 2009, when,
under the belief that MD5-based signatures had indeed been disallowed,
we made the program sources for a chosen-prefix collision attack
publicly available. Furthermore, it should be noted that, even without a
collision attack, Microsoft has unsuspectingly been providing its TSLS
customers with unwarranted code-signing abilities.</p></blockquote>
<blockquote>
<p>We have developed a forensic tool for collision attacks [7] that can
efficiently detect a wide range of known and unknown collision attacks
against MD5 as well as MD5's successor SHA-1. Moreover, this tool may
also be used to online detect fraudulent certificates constructed using
a collision attack.</p></blockquote>
<p>Using our forensic tool, we have indeed verified that a chosen-prefix
collision attack against MD5 has been used for Flame. More
interestingly, the results have shown that not our published
chosen-prefix collision attack was used, but an entirely new and unknown
variant. Therefore it is not unreasonable to assume that the particular
chosen-prefix collision attack variant underlying Flame had already been
in development before June 2009. This has led to our conclusion that the
design of Flame is partly based on world-class cryptanalysis. Further
research will be conducted to reconstruct the entire chosen-prefix
collision attack devised for Flame.</p>
<p>Lo que demuestra, una vez más, que no importa cuanta investigación se
haga en criptografía, estos resultados no son adoptados por la industria
hasta que ocurre un desastre...</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p> &ldquo;How to break MD5 and other hash functions&rdquo;, Xiaoyun Wang and
Hongbu Yu, EUROCRYPT 2005, Lecture Notes in Computer Science, vol. 3494,
Springer, 2005, pp. 19&ndash;35.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</section></main>
        <footer id="main-footer"><div class="footer">
  <a href="#">Scroll to Top</a>
  <div class="footer-copyright">
    <div class="dim">© 2025 Eduardo Díaz</div>
    <div>Made with ❤️ and powered by <a href="https://github.com/math-queiroz/rusty-typewriter" target="_blank">Rusty Typewriter</a> theme for <a href="https://gohugo.io/" target="_blank">Hugo</a></div>
  </div>
</div>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-details">
    <span>713 words</span>
    <span>4 - 5 minutes read</span></div><h3>Related</h3>
    <ul><li><a href="/posts/2012/semana-de-turing/">Semana de Turing</a></li><li><a href="/posts/2012/origenes/">Orígenes</a></li><li><a href="/posts/2012/el-enigma-de-turing/">El Enigma de Turing</a></li><li><a href="/posts/2012/maquina-universal/">Máquina Universal</a></li><li><a href="/posts/2012/lo-bueno-y-lo-malo/">Lo bueno y lo malo</a></li></ul></aside></div>
  </div>
</body>
</html>
